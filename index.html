<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
    <title>Teste Yago</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="cabecalho">
            <a href="javascript:" onclick="paginaProdutos()" id="linkProdutos">Produtos</a> |
            <a href="javascript:" onclick="paginaCategorias()" id="linkCategorias">Categorias</a>
        </div>

        <div id="main"></div>
    </div>

    <script src="categorias/categorias.js"></script>
    <script src="produtos/produtos.js"></script>

    <script>
        var serverUrl = 'http://' + document.location.host + '/teste_yago/'
            // var serverUrl = 'https://' + document.location.host + '/'

        function paginaProdutos() {
            var main = document.getElementById("main")

            fetch(serverUrl + 'produtos/produtos.html' /*, options */ )
                .then((response) => response.text())
                .then((html) => {
                    document.title = 'Produtos'
                    main.innerHTML = html;
                    carregarProdutos()
                })
                .catch((error) => {
                    console.warn(error);
                });
        }

        function paginaCategorias() {
            fetch(serverUrl + 'categorias/categorias.html' /*, options */ )
                .then((response) => response.text())
                .then((html) => {
                    document.title = 'Categorias'
                    main.innerHTML = html;
                    carregarCategorias()
                })
                .catch((error) => {
                    console.warn(error);
                });
        }

        function paginaAddCategoria() {
            fetch(serverUrl + 'categorias/add-categoria.html' /*, options */ )
                .then((response) => response.text())
                .then((html) => {
                    document.title = 'Nova Categoria'
                    main.innerHTML = html;
                })
                .catch((error) => {
                    console.warn(error);
                });
        }

        function paginaEditarCategoria(id) {
            fetch(serverUrl + 'categorias/editar-categoria.html' /*, options */ )
                .then((response) => response.text())
                .then((html) => {
                    document.title = 'Editar Categoria'
                    main.innerHTML = html;

                    var requestCategoria = obterCategoria(id)

                    requestCategoria.onreadystatechange = function() {
                        if (requestCategoria.readyState === 4) {
                            if (requestCategoria.status === 200) {
                                categoria = JSON.parse(requestCategoria.response)[0]
                                document.getElementById("descricaoCategoria").value = categoria.nome;
                                document.getElementById("salvarCategoria").setAttribute('onclick', 'salvarCategoria(' + id + ')')
                                document.getElementById("excluirCategoria").setAttribute('onclick', 'excluirCategoria(' + id + ', true)')
                            }
                        }
                    }
                })
                .catch((error) => {
                    console.warn(error);
                });
        }

        function paginaEditarProduto(id) {
            fetch(serverUrl + 'produtos/editar-produto.html' /*, options */ )
                .then((response) => response.text())
                .then((html) => {
                    document.title = 'Editar Produto'
                    main.innerHTML = html;

                    var requestProduto = obterProduto(id)

                    requestProduto.onreadystatechange = function() {
                        if (requestProduto.readyState === 4) {
                            if (requestProduto.status === 200) {
                                produto = JSON.parse(requestProduto.response)[0]
                                document.getElementById("descricaoProduto").value = produto.nome;
                                document.getElementById("salvarProduto").setAttribute('onclick', 'salvarProduto(' + id + ')')
                                document.getElementById("excluirProduto").setAttribute('onclick', 'excluirProduto(' + id + ', true)')

                                categoriasRequest = obterCategorias()

                                categoriasRequest.onreadystatechange = function() {
                                    if (categoriasRequest.readyState === 4) {
                                        if (categoriasRequest.status === 200) {
                                            var categorias = JSON.parse(categoriasRequest.response)

                                            categorias.forEach(categoria => {
                                                addLinhaSelectCategoria(categoria)
                                            });

                                            document.getElementById("categoriaProduto").value = produto.categoria_id;
                                        }
                                    }
                                }
                            }
                        }
                    }
                })
                .catch((error) => {
                    console.warn(error);
                });
        }

        function paginaAddProduto() {
            fetch(serverUrl + 'produtos/add-produto.html' /*, options */ )
                .then((response) => response.text())
                .then((html) => {
                    document.title = 'Novo Produto'
                    main.innerHTML = html;
                    categoriasRequest = obterCategorias()

                    categoriasRequest.onreadystatechange = function() {
                        if (categoriasRequest.readyState === 4) {
                            if (categoriasRequest.status === 200) {
                                var categorias = JSON.parse(categoriasRequest.response)

                                categorias.forEach(categoria => {
                                    addLinhaSelectCategoria(categoria)
                                });
                            }
                        }
                    }
                })
                .catch((error) => {
                    console.warn(error);
                });
        }
    </script>
</body>

</html>